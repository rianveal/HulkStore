function obtenerProductos(){vectorProductos=[],AgregarORemoverClaseNone("loading","r"),url=rutaServicio+"/products",fetch(url).then(o=>o.json()).then(o=>{validaRespuestaPeticion(o,"No se encontraron productos")&&o.forEach(o=>{obj={id:o.id,nombre:o.name,marca:o.brand,categoria:o.category,valorUnitario:o.unitValue,valorVenta:o.saleValue,topeMinimo:o.minimumExistence,topeMaximo:o.maximumExistence,saldo:o.balance,opcion:'<a class="waves-effect waves-light btn blue" id="'+o.id+'"><i class="material-icons">autorenew</i></a>'},vectorProductos.push(obj)}),vectorProductos.length>0&&cargarProductosEnTabla(vectorProductos)}).catch(o=>{console.error(o.message),notificacion("error","Ha ocurrido un error al cargar los productos, intentelo de nuevo",1500)})}function cargarProductosEnTabla(o){null!==tablaProductos&&limpiarTabalProductos(),tablaProductos=$("#tabla-productos").DataTable({data:o,destroy:!0,responsive:!1,columns:[{data:"nombre"},{data:"marca"},{data:"categoria"},{data:"valorUnitario"},{data:"valorVenta"},{data:"topeMinimo"},{data:"topeMaximo"},{data:"saldo"},{data:"opcion"}],pagingType:"full_numbers",responsive:!0,dom:"Bfrtip",paging:!0,select:!0,buttons:[{extend:"excelHtml5",title:"Registro de productos"},"csvHtml5","pdfHtml5"]}),$(".dt-buttons").css("margin","15px 0 0 30px"),$(".buttons-excel").addClass("btn waves-effect waves-light indigo lighten-2"),$(".buttons-csv").addClass("btn waves-effect waves-light indigo lighten-2"),$(".buttons-pdf").addClass("btn waves-effect waves-light indigo lighten-2"),document.querySelector("#tabla-productos").style="width: 100%;",AgregarORemoverClaseNone("loading","a"),AgregarORemoverClaseNone("contenedorTablaProductos","r"),capturarEventoEnTabla()}function capturarEventoEnTabla(){tabla=document.querySelectorAll("#tabla-productos td a"),tabla.forEach(o=>{o.addEventListener("click",e=>{id=o.id,consultarProducto(id),idProductoGeneral=id})})}function validarAgregarProducto(){btnAgregarProducto=document.querySelector("#btnAgregarProducto"),btnAgregarProducto.addEventListener("click",()=>{nombre=document.querySelector("#nombreProducto").value,marca=document.querySelector("#marcaProducto").value,categoria=document.querySelector("#categoriaProducto").value,valorUnitario=document.querySelector("#valorUnitario").value,valorVenta=document.querySelector("#valorVenta").value,topeMinimo=document.querySelector("#topeMinimoProducto").value,topeMaximo=document.querySelector("#topeMaximoProducto").value,saldo=document.querySelector("#saldo").value,""===nombre?focusAndNotification("nombreProducto","info","Nombre de producto es requerido",1e3):""===marca?focusAndNotification("marcaProducto","info","Marca de producto es requerida",1e3):""===categoria?focusAndNotification("categoriaProducto","info","Categroría de producto es requerida",1e3):""===valorUnitario?focusAndNotification("valorUnitario","info","Valor unitario de producto es requerido",1e3):Number(valorUnitario)<0?focusAndNotification("valorUnitario","info","Valor unitario no puede ser menor que cero",1200):""===valorVenta?focusAndNotification("valorVenta","info","Valor venta de producto es requerido",1e3):Number(valorVenta)<0?focusAndNotification("valorVenta","info","Valor venta no puede ser menor que cero",1200):""===topeMinimo?focusAndNotification("topeMinimoProducto","info","Tope mínimo de producto es requerido",1e3):Number(topeMinimo)<0?focusAndNotification("topeMinimoProducto","info","Tope mínimo no puede ser menor que cero",1200):""===topeMaximo?focusAndNotification("topeMaximoProducto","info","Tope máximo de producto es requerido",1e3):Number(topeMaximo)<0?focusAndNotification("topeMaximoProducto","info","Tope máximo no puede ser menor que cero",1e3):Number(topeMaximo)<Number(topeMinimo)?focusAndNotification("topeMaximoProducto","info","Tope máximo no puede ser menor que tope mínimo",1300):(""===saldo&&(saldo=0),obj={name:nombre,brandId:marca,categoryId:categoria,unitValue:valorUnitario,unitSale:valorVenta,minimumExistence:topeMinimo,maximumExistence:topeMaximo,balance:saldo,user:localStorage.getItem("hs_us")},objData=JSON.stringify(obj),agregarProducto(objData))})}function agregarProducto(o){url=rutaServicio+"/product/add/"+o,fetch(url).then(o=>o.json()).then(o=>{validaRespuestaPeticion(o,"Algo salió mal, producto no registrado")&&(obtenerProductos(),mostrarModal("modalAgregarProducto","c"),notificacion("info","Producto registrado",1200))}).catch(o=>{console.error(o.message),notificacion("error","Ha ocurrido un error al registrar el producto, intentelo de nuevo",1500)})}function consultarProducto(o){AgregarORemoverClaseNone("loading","r"),url=rutaServicio+"/product/find/"+o,fetch(url).then(o=>o.json()).then(o=>{validaRespuestaPeticion(o,"Algo salió mal, producto no encontrado.")&&(document.querySelector("#nombreProducto_op").value=o.name,document.querySelector("#valorUnitario_op").value=o.unitValue,document.querySelector("#valorVenta_op").value=o.saleValue,document.querySelector("#topeMinimoProducto_op").value=o.minimumExistence,document.querySelector("#topeMaximoProducto_op").value=o.maximumExistence,document.querySelector("#saldo_op").value=o.balance,obtenerMarcas().then(e=>{cargarSelectorEspecifico("marcaProducto_op",e,o.brandId)}),obtenerCategorias().then(e=>{cargarSelectorEspecifico("categoriaProducto_op",e,o.categoryId)}),AgregarORemoverClaseNone("loading","a"),mostrarModal("modalActualizarProducto","o"),topeMinimo=o.minimumExistence,topeMaximo=o.maximumExistence)}).catch(o=>{console.error(o.message),notificacion("error","Ha ocurrido un error al consultar el producto, intentelo de nuevo",1500)})}function capturarEventoAgregarRestarCantidad(){id=idProductoGeneral,btnAgregarCantidad=document.querySelector("#btnAgregarCantidad"),btnRestarCantidad=document.querySelector("#btnRestarCantidad"),btnAgregarCantidad.addEventListener("click",()=>{saldoActual=document.querySelector("#saldo_op").value,cantidad=document.querySelector("#cantidad").value,""===cantidad?focusAndNotification("cantidad","info","Cantidad no puede ser vacío",1400):(AgregarORemoverClaseDisabled("btnAgregarCantidad","a"),total=Number(saldoActual)+Number(cantidad),total>topeMaximo?(focus("cantidad"),AgregarORemoverClaseDisabled("btnAgregarCantidad","r"),notificacion("info","El tope máximo ("+topeMaximo+") ha sido superado",1300)):agregarMovimientoProducto(id,"s",cantidad,total))}),btnRestarCantidad.addEventListener("click",()=>{saldoActual=document.querySelector("#saldo_op").value,cantidad=document.querySelector("#cantidad").value,0===Number(saldoActual)?(focus("cantidad"),notificacion("info","Stock en cero, no es posible vender.",1200)):Number(saldoActual)>0&&(""===cantidad?focusAndNotification("cantidad","info","Cantidad no puede ser vacío",1400):(AgregarORemoverClaseDisabled("btnRestarCantidad","a"),total=Number(saldoActual)-Number(cantidad),total<0?(focus("cantidad"),AgregarORemoverClaseDisabled("btnRestarCantidad","r"),notificacion("info","No se puede realizar el proceso, STOCK negativo.",1300)):total<topeMinimo?(focus("cantidad"),AgregarORemoverClaseDisabled("btnRestarCantidad","r"),notificacion("info","El tope mínimo ("+topeMinimo+") ha sido superado",1300)):agregarMovimientoProducto(id,"r",cantidad,total)))})}function agregarMovimientoProducto(o,e,a,r){AgregarORemoverClaseNone("loading","r"),obj={id:o,movementType:e,quantity:a,total:r,user:localStorage.getItem("hs_us")},objData=JSON.stringify(obj),url=rutaServicio+"/product/addMovement/"+objData,fetch(url).then(o=>o.json()).then(o=>{AgregarORemoverClaseDisabled("btnAgregarCantidad","r"),AgregarORemoverClaseDisabled("btnRestarCantidad","r"),validaRespuestaPeticion(o,"Movimiento de producto no fue realizado.")&&(AgregarORemoverClaseNone("loading","a"),document.querySelector("#cantidad").value="",document.querySelector("#saldo_op").value=r,obtenerProductos(),notificacion("success","Movimiento registrado",1e3))}).catch(o=>{console.error(o.message),notificacion("error","Ha ocurrido un error al realizar movimiento de producto, intentelo de nuevo",1500)})}function capturarEventoActualizarProducto(){nombre=document.querySelector("#nombreProducto_op").value,marca=document.querySelector("#marcaProducto_op").value,categoria=document.querySelector("#categoriaProducto_op").value,valorUnitario=document.querySelector("#valorUnitario_op").value,valorVenta=document.querySelector("#valorVenta_op").value,topeMinimo=document.querySelector("#topeMinimoProducto_op").value,topeMaximo=document.querySelector("#topeMaximoProducto_op").value,""===nombre?focusAndNotification("nombreProducto_op","info","Nombre de producto es requerido",1e3):""===marca?focusAndNotification("marcaProducto_op","info","Marca de producto es requerida",1e3):""===categoria?focusAndNotification("categoriaProducto_op","info","Categroría de producto es requerida",1e3):""===valorUnitario?focusAndNotification("valorUnitario_op","info","Valor unitario de producto es requerido",1e3):""===valorVenta?focusAndNotification("valorVenta_op","info","Valor venta de producto es requerido",1e3):""===topeMinimo?focusAndNotification("topeMinimoProducto_op","info","Tope mínimo de producto es requerido",1e3):""===topeMaximo?focusAndNotification("topeMaximoProducto_op","info","Tope máximo de producto es requerido",1e3):(obj={id:idProductoGeneral,name:nombre,brandId:marca,categoryId:categoria,unitValue:valorUnitario,unitSale:valorVenta,minimumExistence:topeMinimo,maximumExistence:topeMaximo,user:localStorage.getItem("hs_us")},objData=JSON.stringify(obj),actualizarProducto(objData))}function actualizarProducto(o){url=rutaServicio+"/product/update/"+o,fetch(url).then(o=>o.json()).then(o=>{validaRespuestaPeticion(o,"Algo salió mal, producto no actualizado.")&&(obtenerProductos(),mostrarModal("modalActualizarProducto","c"),notificacion("info","Producto actualizado.",1200))}).catch(o=>{console.error(o.message),notificacion("error","Ha ocurrido un error al actualizar el producto, intentelo de nuevo",1500)})}function capturarEventoAgregarMarca(){btnAgregarMarca=document.querySelector("#btnAgregarMarca"),btnAgregarMarca.addEventListener("click",()=>{marca=document.querySelector("#marcaAgregar").value,""===marca?focusAndNotification("marcaAgregar","info","Digite la marca",1200):(AgregarORemoverClaseDisabled("btnAgregarMarca","a"),obj={name:marca,user:localStorage.getItem("hs_us")},objData=JSON.stringify(obj),url=rutaServicio+"/brand/add/"+objData,fetch(url).then(o=>o.json()).then(o=>{AgregarORemoverClaseDisabled("btnAgregarMarca","r"),validaRespuestaPeticion(o,"Marca no registrada, intentelo de nuevo.")&&obtenerMarcas().then(o=>{cargarSelector("marcaProducto",o),document.querySelector("#marcaAgregar").value="",notificacion("success","Marca agregada.",1e3)})}).catch(o=>{console.error(o.message),notificacion("error","Ha ocurrido un error al guardar la marca, intentelo de nuevo",1500)}))})}function capturarEventoAgregarCategoria(){btnAgregarCategoria=document.querySelector("#btnAgregarCategoria"),btnAgregarCategoria.addEventListener("click",()=>{categoria=document.querySelector("#categoriaAgregar").value,""===categoria?focusAndNotification("categoriaAgregar","info","Digite la categoría.",1200):(AgregarORemoverClaseDisabled("btnAgregarCategoria","a"),obj={name:categoria,user:localStorage.getItem("hs_us")},objData=JSON.stringify(obj),url=rutaServicio+"/category/add/"+objData,fetch(url).then(o=>o.json()).then(o=>{AgregarORemoverClaseDisabled("btnAgregarCategoria","r"),validaRespuestaPeticion(o,"Categoría no registrada, intentelo de nuevo.")&&obtenerCategorias().then(o=>{cargarSelector("categoriaProducto",o),document.querySelector("#categoriaAgregar").value="",notificacion("success","Categoría agregada.",1e3)})}).catch(o=>{console.error(o.message),notificacion("error","Ha ocurrido un error al guardar la categoría, intentelo de nuevo.",1500)}))})}function obtenerMarcasYCategorias(){obtenerMarcas().then(o=>{cargarSelector("marcaProducto",o)}).catch(o=>{console.error(o.message),notificacion("error","Ha ocurrido un error al cargar las marcas, intentelo de nuevo",1500)}),obtenerCategorias().then(o=>{cargarSelector("categoriaProducto",o)}).catch(o=>{console.error(o.message),notificacion("error","Ha ocurrido un error al cargar las categorías, intentelo de nuevo",1500)})}async function obtenerMarcas(){url=rutaServicio+"/brands";let o=await fetch(url);return await o.json()}async function obtenerCategorias(){url=rutaServicio+"/categories";let o=await fetch(url);return await o.json()}function limpiarTabalProductos(){tablaProductos.rows().remove().draw()}origen="http://209.97.145.250:8080",rutaServicio=origen+"/ApiRestHulkStore/recursosWeb/servicios",tablaProductos=null,idProductoGeneral=null,topeMinimo=null,topeMaximo=null,vectorProductos=[],document.addEventListener("DOMContentLoaded",()=>{inicializaciones(),obtenerProductos(),obtenerMarcasYCategorias(),validarAgregarProducto(),capturarEventoAgregarMarca(),capturarEventoAgregarCategoria(),btnActualizar=document.querySelector("#btnActualizar"),btnActualizar.addEventListener("click",o=>{capturarEventoActualizarProducto()}),capturarEventoAgregarRestarCantidad()},!1),history.pushState(null,null,location.href),window.onpopstate=function(){history.go(1)};